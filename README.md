# coupon-system
## 인프런 - 실습으로 배우는 선착순 이벤트 시스템

- race condition = 2개 이상의 쓰레드가 공유 데이터에 엑세스를 하고 동시에 작업을 하려고 할때 발생
- synchronized를 사용하여 처리하면 다중 서버에서는 제대로 동작하지 않음
- mysql, redis lock을 사용하면 해결할 수 있지만 lock을 거는 구간이 길어지면(쿠폰 갯수에 대한 정합성이 아닌 저장하는 부분까지) 성능에 불이익이 있을 수 있음
- redis incr key : value 를 사용하여 쿠폰 갯수에 대해서만 제어하면됨 = redis는 싱글스레드 기반으로 동작함 
- kafka를 사용하여 처리량을 조절하여 데이터베이스에 대한 부하를 줄일 수 있음 -> 쿠폰 생성까지 약간의 텀이 발생됨

### 쿠폰 제한 걸기
- coupon 테이블에 couponType을 만들어서 userId와 함꼐 unique key로 만듬 -> 보통 서비스는 한유저가 여러 쿠폰타입을 가질 수 있기 때문에 실용적인 방법은 아님
- lock을 사용하여 쿠폰 발급여부를 확인하는 방식 -> 카프카 이벤트를 통해 쿠폰이 생성되므로 서비스에서 락을 걸게되면 쿠폰이 여러개 발급될 수 있음, lock 성능 이슈
- redis set 자료구조 활용